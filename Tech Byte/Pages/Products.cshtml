@page
@model Tech_Byte.Pages.ProductModel
@{
    ViewData["Title"] = "Products";
}
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Admin,Member")]

<style>

    body {
        background-color: whitesmoke;
    }

    .product-card {
        background-color: #fff;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid #e0e0e0;
    }

    .product-card:hover {
        transform: scale(1.03);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        z-index: 5;
        cursor: pointer;
    }
</style>

<div class="container my-5">

    <div class="row d-flex justify-content-between align-items-center" style="padding: 0;">
        <div class="col-auto">
            <h2 class="text-center mb-1">Products</h2>
            <p class="text-center text-muted mb-5">@Model.Items.Count @((Model.Items.Count == 1) ? "Product" : "Products")</p>
        </div>
        <div class="col-auto">
            <!-- Search Form -->
            <form id="searchForm" method="get" class="d-flex align-items-center" onsubmit="showSearchResultMessage();">
                <button type="submit" class="btn btn-primary me-2 mb-5">Search</button>
                <input type="text" class="form-control mb-5" name="search" placeholder="Search Name or Category." value="@(!string.IsNullOrEmpty(Model.SearchTerm) ? Model.SearchTerm : Request.Query["category"].ToString())" style="width: 300px;" />
                @if (!string.IsNullOrEmpty(Model.SearchTerm) || !string.IsNullOrEmpty(Request.Query["category"].ToString()))
                {
                    <a href="/Products" class="btn btn-secondary ms-2 mb-5">Clear Filter</a>
                }
            </form>
        </div>
    </div>

    <div class="d-flex justify-content-center gap-4 flex-wrap">
        @foreach (var item in Model.Items)
        {
            <div class="text-center" style="width: 150px;">
                <div class="product-card p-3 rounded shadow-sm">
                    <img src="@item.Image" class="img-fluid mb-2"
                    style="height: 120px; object-fit: contain; cursor: pointer;"
                    alt="@item.Name"
                    data-bs-toggle="modal"
                    data-bs-target="#itemModal-@item.Id" />
                    <h6 class="mb-1" data-bs-toggle="modal"
                        data-bs-target="#itemModal-@item.Id">
                        @item.Name
                    </h6>
                    <p class="mb-0 text-muted">
                        <span class="fw-bold" data-bs-toggle="modal"
                              data-bs-target="#itemModal-@item.Id">₱@item.Price.ToString("N2")</span>
                    </p>
                </div>
            </div>

            <!-- Modal for this item -->
            <div class="modal fade" id="itemModal-@item.Id" tabindex="-1" aria-labelledby="itemModalLabel-@item.Id" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">

                        <div class="modal-header">
                            <h5 class="modal-title" id="itemModalLabel-@item.Id">@item.Name</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>

                        <div class="modal-body">
                            @if (item.Quantity > 0)
                            {
                                <p style="color:green"><strong>On Stock: @item.Quantity</strong></p>
                            }
                            else if (item.Quantity <= 0)
                            {
                                <p style="color:red"><strong>No Stock Available</strong></p>
                            }
                            <div class="text-center mb-3">
                                <img src="@item.Image" class="img-fluid rounded" style="max-height: 180px;" alt="@item.Name" />
                            </div>

                            <p><strong>Name:</strong> @item.Name</p>
                            <div>
                                <strong>Description:</strong>
                                <div style="max-height: 100px; overflow-y: auto; border: 1px solid #ccc; padding: 5px; border-radius: 4px; background-color: #f9f9f9;">
                                    @item.Description
                                </div>
                            </div>
                            <br />
                            <p><strong>Price:</strong> ₱@item.Price.ToString("N2")</p>
                        </div>

                        <div class="modal-footer d-flex justify-content-between align-items-center">
                            <form method="post" asp-page="/Cart" asp-page-handler="Add" class="d-flex align-items-center w-100">
                                <input type="hidden" name="id" value="@item.Id" />
                                <input type="hidden" name="maxquantity" value="@item.Quantity" />
                                <div class="container text-center">
                                    <div class="row d-flex justify-content-between align-items-center">
                                        <div class="col-auto d-flex align-items-center">
                                            <strong class="me-2">Quantity:</strong>
                                            <input class="form-control"
                                                   name="quantity"
                                                   value="@(item.Quantity <= 0 ? "" : "1")"
                                                   min="1"
                                                   max="@item.Quantity"
                                                   placeholder="@(item.Quantity <= 0 ? "" : "")"
                                                   type="number"
                                                   aria-describedby="emailHelp"
                                                   style="width: 80px;"
                                            @(item.Quantity <= 0 ? "disabled readonly" : "")
                                                   onkeydown="return false;" />
                                        </div>
                                        <div class="col-auto">
                                            <button type="submit" class="btn @(item.Quantity > 0 ? "btn-warning" : "btn-secondary")" @(item.Quantity <= 0 ? "disabled" : "")>
                                                @(item.Quantity > 0 ? "Add to Cart" : "Out of Stock")
                                            </button>
                                        </div>
                                    </div>
                                </div>

                            </form>
                        </div>


                    </div>
                </div>
            </div>
        }

    </div>
</div>
